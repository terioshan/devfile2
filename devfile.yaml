schemaVersion: 2.1.0
metadata:
  generateName: vscode
components:
  - name: tools
    container:
      image: quay.io/devfile/universal-developer-image:ubi8-0e189d9
      memoryLimit: 3Gi
commands:
  - id: run-main-script
    exec:
      label: "Run main.sh script"
      component: tools
      workingDir: '${PROJECT_SOURCE}'
      commandLine: |
        ./main.sh
      group:
        kind: run
        isDefault: true
attributes:
  che-editor.yaml: |
    inline:
      schemaVersion: 2.1.0
      metadata:
        name: che-incubator/che-code/insiders
        displayName: che-code
        description: Code OSS integration in Eclipse Che.
        icon: https://raw.githubusercontent.com/che-incubator/che-code/main/code/resources/server/code-512.png?sanitize=true
        attributes:
          publisher: che-incubator
          version: insiders
          title: CheCode Insiders.
          repository: https://github.com/che-incubator/che-code
          firstPublicationDate: '2021-10-31'
          skipMetaYaml: true
      commands:
        - id: init-container-command
          apply:
            component: che-code-injector
      events:
        preStart:
          - init-container-command
      components:
        - name: che-code-injector
          container:
            image: 'quay.io/che-incubator/che-code:insiders'
            command: ["/entrypoint-init-container.sh"]
            volumeMounts:
              - name: checode
                path: /checode
            memoryLimit: 128Mi
            memoryRequest: 32Mi
            cpuLimit: 500m
            cpuRequest: 30m
        - name: che-code-runtime-description
          container:
            image: 'quay.io/devfile/universal-developer-image:ubi8-770ea4a'
            memoryLimit: 1024Mi
            memoryRequest: 256Mi
            cpuLimit: 500m
            cpuRequest: 30m
            command:
              - /checode/entrypoint-volume.sh
            volumeMounts:
              - name: checode
                path: /checode
            endpoints:
              - name: che-code
                attributes:
                  type: main
                  cookiesAuthEnabled: true
                  discoverable: false
                  urlRewriteSupported: true
                path: '?tkn=eclipse-che'
                targetPort: 3100
                exposure: public
                secure: true
                protocol: http
              - name: code-redirect-1
                targetPort: 13131
                exposure: public
                protocol: http
                attributes:
                  discoverable: false
                  urlRewriteSupported: true
              - name: code-redirect-2
                targetPort: 13132
                exposure: public
                protocol: http
                attributes:
                  discoverable: false
                  urlRewriteSupported: true
              - name: code-redirect-3
                targetPort: 13133
                exposure: public
                protocol: http
                attributes:
                  discoverable: false
                  urlRewriteSupported: true
          attributes:
            app.kubernetes.io/component: che-code-runtime
            app.kubernetes.io/part-of: che-code.eclipse.org
        - name: checode
          volume: {}
