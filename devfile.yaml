schemaVersion: 2.1.0
metadata:
  name: vscode
attributes:
  che-editor.yaml: |
    inline:
      schemaVersion: 2.1.0
      metadata:
        name: IntelliJ IDEA Community Edition
      commands:
        - id: init-container-command
          apply:
            component: che-idea-injector
      events:
        preStart:
          - init-container-command
      components:
        - name: che-idea-runtime-description
          container:
            image: 'quay.io/devfile/universal-developer-image:ubi8-eda6672'
            command: 
              - /projector/entrypoint-volume.sh
            env:
              - name: PROJECTOR_ASSEMBLY_DIR
                value: /projector
              - name: PROJECTOR_CONFIG_DIR
                value: /home/user/.jetbrains
            volumeMounts:
              - name: projector-volume
                path: /projector
            memoryLimit: 2048Mi
            memoryRequest: 256Mi
            cpuLimit: 500m
            cpuRequest: 30m
            endpoints:
              - name: intellij
                attributes:
                  type: main
                  cookiesAuthEnabled: true
                  discoverable: false
                  urlRewriteSupported: true
                targetPort: 8887
                exposure: public
                path: '/?backgroundColor=434343&wss'
                secure: false
                protocol: http
          attributes:
            app.kubernetes.io/component: che-idea-injector
            app.kubernetes.io/part-of: che-idea.eclipse.org
        - name: projector-volume
          volume: {}
        - name: che-idea-injector
          container:
            image: 'quay.io/che-incubator/che-idea:2020.3.4-next'
            command: ["/projector/entrypoint-init-container.sh"]
            env:
              - name: PROJECTOR_VOLUME_MOUNT
                value: /projector-volume
              - name: PROJECTOR_ASSEMBLY_DIR
                value: /projector
            volumeMounts:
              - name: projector-volume
                path: /projector-volume
            memoryLimit: 128Mi
            memoryRequest: 32Mi
            cpuLimit: 500m
            cpuRequest: 30m
components:
  - name: dev
    container:
      image: quay.io/che-incubator/che-code-dev:insiders
      memoryLimit: 7Gi
      cpuLimit: 3500m
      endpoints:
        - exposure: public
          name: dev
          secure: true
          protocol: http
          targetPort: 8000
  - name: projects
    volume:
      size: 3Gi
commands:
  - id: build
    exec:
      component: dev
      workingDir: ${PROJECTS_ROOT}/che-code
      commandLine: |
        yarn watch
      group:
        kind: build
        isDefault: true
  - id: run
    exec:
      component: dev
      workingDir: ${PROJECTS_ROOT}/che-code
      commandLine: |
        yarn server
      group:
        kind: run
        isDefault: true
